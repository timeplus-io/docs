# 收录 REST API

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

你可以运行 \`INSERT INTO [stream] (column1, column2) VALUES (..) SQL 将数据插入到 Proton。 您还可以使用任何首选语言调用摄取 REST API 将数据推送到 Proton。 这可能更适合将 Proton 与其他系统或实时数据源（例如物联网传感器）集成。

## 先决条件

### 从 Proton 容器中暴露端口 3218

默认情况下，Proton 采集 REST API 位于端口 3218 上。 请在暴露了 3218 端口的情况下启动Proton容器。 例如：

```shell
docker run-d-p 3218:3218--pull always--name proton ghcr.io/timeplus-io/proton: latest
```

### 在 Proton 中创建流

你需要通过 [CREATE STREAM]（Proton创建流）在 Timeplus 中创建流。 应设置具有正确名称和类型的列。

首先运行 SQL 客户端

```shell
docker exec-it ProtonProton客户端
```

然后运行以下 SQL 来创建流。

```sql
CREATE STREAM foo（id 整数，名称字符串）
```

## 将数据推送到 Timeplus

实时数据摄取的端点是 'http://localhost:3218/proton/v1/ingest/streams/{stream_name}\`。 HTTP 方法是 POST。

**索取样品：**

<Tabs defaultValue="curl">
<TabItem value="js" label="Node.js" default>

```js
const http = require (“http”);
const options = {
  主机名：“本地主机”，
  路径：“/proton/v1/ingest/streams/foo”，
  方法：“POST”
}；

const data = `
{
  “列”：[“id”，“名称”]，
  “数据”：[
    [1, “你好“],
    [2, “世界”]
  ]
}
`;
const 请求 = http.request (选项, (resp) => {});
request.on (“错误”, (错误) => {
  控制台错误 (错误);
});
request.write (数据);
request.end ();
```

</TabItem>
  <TabItem value="curl" label="curl">

```bash
curl-s-X POST http://localhost:3218/proton/v1/ingest/streams/foo\
-d '{
  “列”：[“id”，“名称”]，
  “数据”：[
    [1，“你好”]，
    [2，“世界”]
  ]

'
```

</TabItem>
  <TabItem value="py" label="Python">

```python
导入请求

url = “http://localhost:3218/proton/v1/ingest/streams/foo”
标头 = {
    “内容类型”：“application/json”
}
data = “'
{
  “列”：[“id”，“名称”]，
  “数据”：[
    [1，“你好”]，
    [2，”世界”]
  ]
}
“'

响应 = requests.post（网址，标题=标题，数据=数据）
打印（response.status_code）
打印（response.status_code）打印（response.text）
```

</TabItem>
  <TabItem value="java" label="Java">

```java
导入 okhttp3.MediaType；
导入 okhttp3.okHttpClient；
导入 okhttp3.request；
导入 okhttp3.requestBody；
导入 okhttp3.Response；

导入 java.io.ioException；

公共类示例 {
    公共静态空白 main (String [] args) 抛出 IOException {
        OkHttpClient 客户端 =全新 OkhttpClient ();

        字符串 url = “http://localhost:3218/proton/v1/ingest/streams/foo”;
        MediaType MediaType = MediaType.Parse (“application/json”);
        字符串数据 = “”
{
  “列”: [“id”, “名称”],
  “数据”: [
    [1, “你好”],
    [2, “世界”]
  ]
}
          “”;
        requestBody 正文 = requestBody.Create（媒体类型，数据）；

        请求请求 = 新的 Request.Builder ()
                .url (url)
                .post (body)
                .build ();

        尝试（响应响应 = client.newCall（请求）.execute ()) {
            System.out.Println（响应。code ());
            System.out.println (response.body () .string ());
        }
    }
}}
```

</TabItem>
</Tabs>
上述方法应该适用于大多数系统集成。 但是，将在请求的正文中反复提及这些列的名称。

我们还提供了一种性能更高的解决方案，只列出一次列名。

请求正文采用以下格式：

```json
{
  “列”：[..]，
  “数据”：[
    [..]，
    [..]
  ]
}
```

备注：

- `columns` 是一个字符串数组，其中包含列名
- `数据`是一个数组数组。 每个嵌套数组代表一行数据。 值顺序必须与 “列” 中完全相同的顺序匹配。

例如：

```json
{
  “列”：[“key1"，“key2"]，
  “数据”：[
    [“value11"，“value12"]，
    [“value21"，“value22"]
  ]
}
```

您也可以使用我们的软件开发工具包来提取数据，而无需处理 REST API 的低级细节。
